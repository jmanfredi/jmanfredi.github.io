---
title: 'Is staying home really going to stop COVID-19?'
date: 2020-03-17
permalink: /posts/2020/03/corona/
excerpt: "I can go the social distance"
tags:
  - agent-based modeling
  - data visualization
---

"Whatâ€™s true of all the evils in the world is true of plague as well. It helps men to rise above themselves."

*Albert Camus, The Plague*

Unless you have been [rafting through the Grand Canyon](https://www.nytimes.com/2020/03/17/opinion/coronavirus-news.html) for the past three weeks, you are by now intimately familiar with the COVID-19 epidemic rampaging across the world. Our new reality has brought with it a fresh set of buzzwords, like "social distancing" and "asymptomatic transmission". In particular you hear a lot about the importance of trying to "flatten the curve". This means that slowing down the spread of COVID-19 can prevent our medical infrastructure from being overrun. Otherwise, we could have so many patients with COVID-19 simultaneously that we can't treat them all. Think about this way: an average hospital can easily treat 1000 patients a month, but not 1000 patients a day. Here is a useful picture from The Economist:

![economist](/images/for-posts/corona/flattencurve.png){:class="img-responsive"}
*Source: [The world gets ready](https://www.economist.com/briefing/2020/02/29/covid-19-is-now-in-50-countries-and-things-will-get-worse), The Economist.* 

If that curve (representing the number of sick people at any give time) is flattened out in time enough, then we'll be able to properly treat the sick. At least, that's the idea. How does this work? We can investigate with a simple software model.

Let's make imaginary friends and give them coronavirus
======

[Agent-based modeling](https://en.wikipedia.org/wiki/Agent-based_model) is a type of computer simulation studying the actions and interactions of a set of entities, or "agents". In simpler words, you start by making an individual agent (e.g. a car) that follows a set of simple rules (e.g. follow the speed limit, brake within a certain distance of other cars, etc.). Then you simulate a whole bunch of these agents in the same environment. The interesting part is that when these uncomplicated individual agents interact with each other, complex behavior emerges (like [traffic patterns](https://www.youtube.com/watch?v=nQGGsa9CRNY))! This approach is often used to study the spread of diseases like COVID-19.

*Note: as I was putting this post together, I found [an excellent article in the Washington Post](https://www.washingtonpost.com/graphics/2020/world/corona-simulator/?itid=sf_) in which they also use agent-based modeling to study coronavirus. I recommend reading it.*

Here is a basic example. Just two agents, as shown by the two dots, sitting on a two-dimensional grid. The model evolves in discrete time steps, and in each step an agent can move in a random direction and interact with other agents in the same cell of the grid.  

![simple-gif](/images/for-posts/corona/corona-simple.gif){:height="500px" width="500px"}

The blue dot represents a normal, healthy person, and the red one is carrying the COVID-19 virus. They each move once per step in a random direction, and when they share the same cell they interact. Almost like they are shaking hands with each other and talking about this weather we've been having. This gives a chance for the COVID-19 dot to pass the virus along to the healthy dot. Then both dots go about their merry lives, until either they get over the disease and become cured (green) or, about 3% of the time, they die (and vanish off the screen). Treating each model step as one day, the length of the disease is set to 14 days which corresponds to the typical duraction of COVID-19 in the real world. We assume here that once somebody gets COVID-19 and is cured of it, they are immune to getting it again.

Okay, let's add some more dots. Say, 1000 total, with 999 healthy (blue) and one disease carrier (red). See the GIF below. The carrier quickly infects its neighbors to create an ever-growing cluster of red, and almost all the dots are infected at one point in time or another. Those dots either become green to indicate that they are cured, or they die and disappear. Below the grid is a chart showing how the number of disease carriers (red line) and the number of cured people (green line) changes over time.

![big-gif](/images/for-posts/corona/corona-big.gif){:height="500px" width="500px"}

As the disease spreads, the red line showing the number of carriers goes up until it reaches a maximum of almost half the population at about 40 days in, and then drops as the disease starts fading away. The green line continues to rise until it flattens out at almost the entire population. The red line is the curve that we are trying to "flatten": imagine the disaster if the Dot General Hospital only has the space to accommodate maybe 40 or 50 or 100 sick dots at a time. Can social distancing really work to do this? We can test it out. 

This time, 20 days into the simulation 80% of the dots start social distancing. That is, they stay still. That number is only 80% because there are always essential services (doctors, nurses, grocery store employees, mailmen, etc.) that need to stay active, and because some people ignore the policy entirely.

![sd-20-gif](/images/for-posts/corona/corona-sd-20.gif)

The social distancing begins when the infection rate is starting to pick up, but well before it reaches the peak of half the population carrying the disease simultaneously that we saw before. The impact is immediate. Significantly fewer interactions means significantly slower infection rate. The point of maximum infection happens at about 20% of the total population. 

Histogram

"Yes, okay, whatever", I hear you saying, "but I'm not sick! Why should I care?". Well, reader, there are two reasons you should care. First, most cases of COVID-19 present asymptomatically. Although you most likely aren't infected right now, you could be. And even if [you feel great](https://www.nba.com/article/2020/03/16/donovan-mitchell-interview-says-asymptomatic), you could pass on the disease to a relative, coworker, or passerby that is not as lucky. Second, COVID-19 has an incubation period of several days. If you contract it, you can spread it to other people for days afterwards before your symptoms even present. So even if only sick people practiced social distancing, there is still an ample window for the disease to spread.

We can actually add this in to our model. For each dot that gets infected, let's assume that it takes at least 5 days for symptoms to present. Once that happens, the dot remains stationary. Here is what a sample simulation looks like:

![sd-sick-gif](/images/for-posts/corona/corona-sd-sick.gif)

Looks pretty bad. 

Obviously, this is just a toy model and no quantitative results from it should be taken seriously. Rather, takeaway is that agent-based modeling lets us observe directly the dynamics of a few disease carriers seeding a large epidemic, even when people who feel sick practice social distancing. So stay home. Even if you feel healthy.

Technical Details
------
Code used for gathering data, analysis, and plot generation can be found [here](https://github.com/jmanfredi/corona). The agent-based modeling (ABM) is dont with [Mesa](https://mesa.readthedocs.io/en/master/index.html), which for the most part worked well. It does not have an abundance of features and I wish there was an easy way to set an end condition (e.g. end the simulation when there are no more carriers left). Still, it is straightforward to use and the visualization works well. I recommend it if you want to play around with ABM.

There are some paramaters in the code which are in principle tunable. The disease lasts for a fixed length of 14 days. The infection rate is 100%. Despite the fact that this number is unrealistic, I set it to 100% for three reasons: 1) in real life, a person can get the virus not just by interacting with another person, but with an inanimate object (e.g. you used the same door knob that a sick person did), 2) these dots have fewer average interactions per day than a typical working person, and 3) there was no good value for this in any COVID-19 studies. The probability that a dot dies on a given step is 0.22%. I set this value so that over the course of a 14-day illnesss roughly 3% of the dots end up dead, since this is about what the overall case fatality rate is expected to be for COVID-19. So with
\\(
(1 - p)^{14} = 0.97
\\)
where \\( p \\) is the probability that a dot dies on a given step, then p comes out to be 0.22%. 

Each simulation starts with one randomly placed carrier dot amid a population of healthy ones. For each step of the model, each (living) dot moves in a random direction, unless they are social distancing. If the dot is a carrier, it interacts with all the other dots in the same cell, and potentially infects them. Lastly we check to see if the dot dies, and if not then increment the sick day counter. After 14 days, the dot becomes cured and is no longer a carrier. The dots act in a random order that changes with each step. The visualizations above only show, so it may look like the disease passes between two dots that never shared a cell. In fact, they did share a cell for part of a turn, before one of them moved away.

I used Jupyter Notebooks to play around with figure generation and to run batches. I have reservations about Jupyter Notebooks (read more [here](https://towardsdatascience.com/the-case-against-the-jupyter-notebook-d4da17e97243)) but they can be a helpful tool as long as one is aware of the limitations. To make the gifs, I screen-captured the web-based visualization and then threw them into [PicGIF Lite](https://apps.apple.com/us/app/picgif-lite/id844918735?mt=12).


