---
title: 'Is staying home really going to stop COVID-19?'
date: 2020-03-17
permalink: /posts/2020/03/corona/
excerpt: "I can go the social distance"
tags:
  - agent-based modeling
  - data visualization
---

"Whatâ€™s true of all the evils in the world is true of plague as well. It helps men to rise above themselves."

Albert Camus, The Plague

Unless you have been [rafting through the Grand Canyon](https://www.nytimes.com/2020/03/17/opinion/coronavirus-news.html) for the past three weeks, you are by now intimately familiar with the COVID-19 epidemic rampaging across the world. Nobody knows how much higher the infection numbers will climb, or how much longer preventative measures will be necessary. 

Our new reality has brought with it a fresh set of buzzwords, like "social distancing" and "asymptomatic transmission". In particular you hear a lot about the importance of trying to "flatten the curve". This means that if we can slow down the spread of COVID-19, then we can prevent our medical infrastructure from being overrun. Think about this way: an average hospital can easily treat 1000 patients a month, but not 1000 patients a day. Here is a useful picture from The Economist:

![economist](/images/for-posts/corona/flattencurve.png){:class="img-responsive"}
*Source: [The world gets ready](https://www.economist.com/briefing/2020/02/29/covid-19-is-now-in-50-countries-and-things-will-get-worse), The Economist.* 

If the curve is flattened out in time enough, then we'll be able to properly treat the sick. At least, that's the idea. But does it work? As we get used to our new socially distanced lives, let's try something to find out.

Let's make imaginary friends and give them coronavirus
======

[Agent-based modeling](https://en.wikipedia.org/wiki/Agent-based_model) is a type of computer simulation of the actions and interactions of a set of entities, or "agents". Basically, you start by programming an individual agent with a set of simple rules. Then you simulate a whole bunch of these agents interacting together. The interesting part is that from these uncomplicated individual agents, complex behavior emerges! For example, you could have each agent be a car that behaves in a straightforward way (follows the speed limit, brakes within a certain distance of another car, etc.), and [complex traffic patterns](https://www.youtube.com/watch?v=nQGGsa9CRNY) can emerge. This approach is often used to study epidemics like COVID-19. Let's see if we can make one happen.

*Note: as I was putting this post together, I found [an excellent article in the Washington Post](https://www.washingtonpost.com/graphics/2020/world/corona-simulator/?itid=sf_) in which they also use agent-based modeling to study coronavirus. I recommend reading it.*

Here is a basic example. Two dots. The blue one represents a normal, healthy person, and the red one is carrying the COVID-19 virus. They each move around in a random direction, and when they share the same cell they interact. Almost like they are shaking hands with each other and talking about this weather we've been having. This gives a chance for the COVID-19 dot to pass the virus along to the healthy dot. Then both dots go about their merry lives, until either they get over it and become cured (green) or, about 3% of the time, they die (and vanish off the screen). I am assuming that once somebody gets COVID-19 and is cured of it, they are immune to getting it again.

![simple-gif](/images/for-posts/corona/corona-simple.gif)

Okay, let's add some more dots. Here you can see more clearly the dynamics of the disease spreading through the population. One carrier at the start quickly becomes an ever-growing cluster of red, and that ends up infecting almost all the dots at one point in time or another. Those dots either become green to indicate that they are cured, or they die and disappear. 

BIG

That red line going up and down indicates the number of active carriers at any given time in the simulation. THAT is the curve that we are trying to "flatten". Does social distancing really work to do this? We can test it out. 

SOCIAL DISTANCING RESULTS

"Yes, okay, whatever", I hear you saying, "but I'm not sick! Why should I care?". Well, reader, the reason you should care is that most cases of COVID-19 present asymptomatically. Although you most likely aren't infected, you could be. And even if [you feel great](https://www.nba.com/article/2020/03/16/donovan-mitchell-interview-says-asymptomatic), you could pass on the disease to a relative, coworker, or passerby that is not as lucky. 

ONLY SICK DISTANCE AND ON DELAY

Obviously, this is just a toy model and no quantitative results from it should be taken seriously. Rather, takeaway is that agent-based modeling lets us observe directly the dynamics of a few disease carriers seeding a large epidemic, even when people who feel sick practice social distancing. So stay home. Even if you feel healthy.

Technical Details
------
Code used for gathering data, analysis, and plot generation can be found [here](https://github.com/jmanfredi/corona). The agent-based modeling (ABM) is dont with [Mesa](https://mesa.readthedocs.io/en/master/index.html), which for the most part worked well. It does not have an abundance of features and I wish there was an easy way to set an end condition (e.g. end the simulation when there are no more carriers left). Still, it is straightforward to use and the visualization works well. I recommend it if you want to play around with ABM.

There are some paramaters in the code which are in principle tunable. The disease lasts for a fixed length of 14 days. The infection rate is 100%. Despite the fact that this number is unrealistic, I set it to 100% for three reasons: 1) in real life, a person can get the virus not just by interacting with another person, but with an inanimate object (e.g. you used the same door knob that a sick person did), 2) these dots have fewer average interactions per day than a typical working person, and 3) there was no good value for this in any COVID-19 studies. The probability that a dot dies on a given step is 0.22%. I set this value so that over the course of a 14-day illnesss roughly 3% of the dots end up dead, since this is about what the overall case fatality rate is expected to be for COVID-19. So with
\\(
(1 - p)^{14} = 0.97
\\)
where \\( p \\) is the probability that a dot dies on a given step, then p comes out to be 0.22%. 

Each simulation starts with one randomly placed carrier dot amid a population of healthy ones. For each step of the model, each (living) dot moves in a random direction, unless they are social distancing. If the dot is a carrier, it interacts with all the other dots in the same cell, and potentially infects them. Lastly we check to see if the dot dies, and if not then increment the sick day counter. After 14 days, the dot becomes cured and is no longer a carrier. The dots act in a random order that changes with each step. The visualizations above only show, so it may look like the disease passes between two dots that never shared a cell. In fact, they did share a cell for part of a turn, before one of them moved away.

I used Jupyter Notebooks to play around with figure generation and to run batches. I have reservations about Jupyter Notebooks (read more [here](https://towardsdatascience.com/the-case-against-the-jupyter-notebook-d4da17e97243)) but they can be a helpful tool as long as one is aware of the limitations.


